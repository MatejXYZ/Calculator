<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Calculator2</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
  <style>
    body {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      font-family: 'Roboto', sans-serif;
      color: #321;
    }

    #display {
      border: solid #246;
      height: 75px;
      width: 300px;
      padding: 5px;
      font-size: xx-large;
    }
    button {
      font-size: x-large;
    }
  </style>
</head>

<body>
  <div id='display'></div>
  <!--
  <button>0</button>
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>.</button>
  <button>+</button>
  <button>-</button>
  <button>*</button>
  <button>/</button>
  <button>Backspace</button>
  -->
  <script>
    const beginningValues = ['0', 'is', '0', 0, {operation:'multiply', value:'begin'}, 1];
    let [currentValue, currentOperation, lastValue, pending, lastExecution, isResult] = beginningValues;
    const display = document.getElementById('display');
    function update() {
      display.textContent = currentValue;
      console.log(lastValue)
    }
    const operations = {
      is: (a,b) => a,
      add: (a,b) => +a + +b,
      subtract: (a,b) => a - b,
      multiply: (a,b) => a * b,
      divide: function(a,b) {
        if (!+b) {
         display.textContent = 'Error';
         return 0; 
        }
        return a / b;
      }
    }
    const bf = {
      write: function(char) {
        if (char === '.') {
          if (currentValue.lastIndexOf('.') !== -1) return;
          if (!pending && !isResult) return;
          else if (currentValue === '0') return currentValue = '0.'
        }
        if (currentValue === '0') return currentValue = '' + char;
        if (pending || isResult) {
          currentValue = currentValue + char
        } else {
          lastValue = currentValue;
          currentValue = '' + char;
          pending = 1;
        }
      },
      chooseOp: function(operation = 'multiply') {
        if (pending) {
          lastExecution.value = currentValue;
          lastExecution.operation = currentOperation;
          currentValue = '' + operations[currentOperation](lastValue, currentValue);
          pending = 0;
        }
        isResult = 0;
        currentOperation = operation;
      },
      equals: function() {
        if (pending) {
          lastExecution.value = currentValue;
          lastExecution.operation = currentOperation;
          currentValue = '' + operations[currentOperation](lastValue, currentValue);
          pending = 0;
        } else {
          if (lastExecution.value === 'begin') [lastExecution.value, lastExecution.operation] = [currentValue, currentOperation];
          else currentValue = '' + operations[lastExecution['operation']](currentValue, lastExecution['value']);
        }
          isResult = 1;
      },
      backspace: function() {
        if (currentValue.length === 1) {
          return currentValue = '0';
          } else if (currentValue.length === 2 && currentValue.includes('-')) {
            return currentValue = '0';
          } else {
            return currentValue = currentValue.replace(/\d$|\.$/, '');
            }
      },
      clear: () => [currentValue, currentOperation, lastValue, pending, lastExecution, isResult] = beginningValues
    }
    


    const numberCharacterRegex = /\d|\./;

//temporary
    window.addEventListener('click', update);
    window.setInterval(update, 500);

    function addFn(callback, argument) {
      let myNewButton = document.createElement('button');
      document.body.appendChild(myNewButton);
      myNewButton.textContent = argument || callback.name;
      myNewButton.addEventListener('click', () => {
        callback(argument);
      })
    }
    addFn(bf.write, '0')
    for (let i = 1; i < 10; i++) {
      addFn(bf.write, i, 1)  
    }
    addFn(bf.write, '.');
    addFn(bf.chooseOp, 'add');
    addFn(bf.chooseOp, 'subtract');
    addFn(bf.chooseOp, 'multiply');
    addFn(bf.chooseOp, 'divide');
    addFn(bf.backspace);
    addFn(bf.equals);
    addFn(bf.clear);
  </script>
</body>

</html>